# containerized-hybrid-node
This is the beginnings of a project to create a containerized version of an EKS hybrid node. It uses Amazon Linux 2023 as the parent container. The `entrypoint.sh` file runs a script that installs the prerequisites needed to run an EKS hybrid node including nodeadm which install various software components, creates configuration files from information retrieved from the cloud, and attempts to start different services such as the kubelet. The output of this script is saved to `/var/log/nodeadm_poststart_commands.log`. If you try this on your own, you may see errors in the log. Ignore these for now.

When you run `make run`, it will exec into the container automatically. Run the `setup-overlay.sh` script after the `entrypoint.sh` script is finished running. You may have to make it executable by running `chmod +x` first. This script will basically fool the container into thinking that it is using an overlay file system which is required for running nested containers. When that script has finished running, run the `update-containerd.sh` script next. This script will modify the containerd `config.toml` file to use the mock overlay file system. DO NOT re-run the `nodeadm init` command from hereon as this will overwrite the config.toml settings. The settings in the `update-container.sh` can and should be moved to the nodeConfig.yaml file, but I haven't had time to do that yet. 

At this stage, if you followed the other prerequisites for running hybrid nodes, you should see the container appear as a node in your cluster. It will be in a `Not Ready` state because it is unable to pull images from ECR (a problem I have yet to troubleshoot). 

I would welcome help from the community if you are interested in contributing to this project. 
